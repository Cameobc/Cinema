<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="NoticeMapper">
 	<select id="getTotalCount" parameterType="PageMaker" resultType="Integer">
 		SELECT COUNT(*) FROM NOTICE
 		WHERE 
 		<choose>
			<when test="kind=='t'">
			 		TITLE
			 </when>
			 <when test="kind=='w'">
			 		WRITER
			 </when>
			 <otherwise>
			 		CONTENTS
			 </otherwise>
		</choose>
		LIKE '%' ||#{search}|| '%'
 	</select>
 
 	<select id="getList" parameterType="PageMaker" resultType="NoticeVO">
 		SELECT * FROM
	 		(SELECT ROWNUM R, N.* FROM
		 		(SELECT * FROM NOTICE
			 		WHERE
			 		<choose>
			 			<when test="kind=='t'">
			 				TITLE
			 			</when>
			 			<when test="kind=='w'">
			 				WRITER
			 			</when>
			 			<otherwise>
			 				CONTENTS
			 			</otherwise>
			 		</choose>
			 		LIKE '%' ||#{search}|| '%' ORDER BY NUM DESC) 
			 	N)
		 WHERE R BETWEEN #{startRow} and #{lastRow}	
 	</select>
 
 	<insert id="setWrite" parameterType="NoticeVO">
 	<selectKey order="BEFORE" resultType="Integer" keyProperty="num">
 		SELECT NOTICE_SEQ.NEXTVAL FROM DUAL
 	</selectKey>
 		INSERT INTO NOTICE VALUES
 		(#{num}, #{title}, #{writer}, #{contents}, SYSDATE, 0)
 	</insert>
 </mapper> 